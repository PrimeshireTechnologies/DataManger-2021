
<link href="~/Content/bootstrap.css" rel="stylesheet" />
<link href="~/Content/multi.css" rel="stylesheet" />
<script src="~/Scripts/jquery-3.3.1.js"></script>
<script src="~/Library/angular.min.js"></script>

<section ng-app="app" class="col-md-12">
    <br />
    <br />
    <br />
    <!--<br />-->
    <div ng-controller="viewController" class="container">
        <div class="col-md-12">
            <div class="col-md-4 col-md-offset-4">                
                <div class="box" style="border-radius:8px;position:fixed;top:50%;left:50%;width:30em;height:27em;margin-top:-12em;margin-left:-15em;background-color:white; box-shadow:inset 0 0px #28c4f4; border:2px solid #28c4f4;">
                    <div class="content-wrap" style="margin-left:55px;margin-top:40px;">                        

                        <h2 style="margin-left:30px;text-shadow: 1px 1px 1px #000000; color:lightgray;">Forgot Password</h2>

                        @using (Html.BeginForm())
                        {
                            <div class="form-horizontal">
                                <hr />
                                <div class="text-success">
                                    @ViewBag.Message
                                </div>
                                <br />
                                <div class="form-group" style="margin-left:8px;">
                                    <label style="margin-left:0px;">Please type your <span style="color:#614ad3"> Email ID </span> </label>
                                    <input class="form-control" type="email" id="email_validation" tabindex="4" style="height:40px; background-color:transparent;" autocomplete="off" multiple>
                                    @*@Html.TextBox("EmailID", "",new { @class="form-control"})*@
                                </div>
                                <br />
                                <br />
                                <br />
                                <div class="form-group">
                                    <div class="col-md-offset-2 col-md-10" style="margin-left:80px;">
                                        <a class="btn btn-primary signup" style="width:120px;" onclick="VerifyEmail()">Submit</a>                                        
                                    </div>
                                </div>
                            </div>
                        }

                    </div>                   
                </div>
                <div>

                </div>
                <script>
                    function focusemail() {
                        document.getElementById("email").focus();
                    }

                    let idleTime = 0;
                    $(document).ready(function () {
                        //Increment the idle time counter every minute.
                        idleInterval = setInterval(timerIncrement, 60000); // 1 minute

                        //Zero the idle timer on mouse movement.
                        $('body').mousemove(function (e) {
                            idleTime = 0;
                        });

                        $('body').keypress(function (e) {
                            idleTime = 0;
                        });

                        $('body').click(function () {
                            idleTime = 0;
                        });

                        function timerIncrement() {
                            idleTime = idleTime + 1;
                            if (idleTime > 6) {
                                window.location.href = "/Home/Login";
                            }
                        }
                    });

                    function VerifyEmail() {
                        var url = window.location.href;
                        var arr = url.split("/");
                        var result = arr[0] + "//" + arr[2];

                        if (document.getElementById('email_validation').validity.valid && document.getElementById('email_validation')['value'] !== "") {
                            var verifyvalue = {
                                'Email': document.getElementById('email_validation')['value']
                            };
                            console.log(verifyvalue);
                            $.ajax({
                                url: result + '/api/Forgotpass/Verifyemail', type: 'POST', data: JSON.stringify(verifyvalue), dataType: 'json', contentType: "application/json", success: function (response) {
                                    if (response.trim() !== ",") {                                                                                
                                       
                                        var varr = response.split(',');

                                        localStorage.setItem("Stringautocode", varr[1]);
                                        localStorage.setItem("varEmail", varr[0]);                                       

                                        window.location.href = "/Home/Verificationcode";                                                                                         

                                    } else {

                                        swal("Invalid email!", "Email Address cannot be found in the system", {
                                            className: "swal-title"
                                        });                                        
                                    }
                                }, error: function (response) {
                                    swal("Failed", "Email verification failed", {
                                        className: "swal-title"
                                    });
                                }
                            });
                        } else {
                            if (document.getElementById('email_validation')['value'] === "") {
                                swal("Empty!", "Empty Email address", {
                                    className: "swal-title"
                                });
                            } else {
                                swal("Invalid!", "Invalid Email Address", {
                                    className: "swal-title"
                                });
                            }
                        }                             
                    }

                </script>
            </div>
        </div>
    </div>
    <div style="position:fixed;top:50%;left:50%;width:38em;height:18em;margin-top:25em;margin-left:-16em; color:black;font-weight:900; font-size:12px;font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;">
        <p>&copy; @DateTime.Now.Year <a href="https://www.primeshire.tech/" onmouseover="mouseover()" onmouseout="mouseout()" rel="noopener noreferrer" target="_blank" style="text-shadow: 2px 1px 0px #000000; color:cornflowerblue;font-weight:bolder; font-size:15px;">Primeshire Technologies. </a> <span style="margin-left:1px;"><span style="margin-left:1px;">All Rights Reserved</span></span> <span style="margin-left:5px;color:darkslategrey;font-weight:900;font-family:Tahoma;">V 1.0.5</span></p>
    </div>
    <br />        
    <script src="~/Scripts/multi.js"></script>
</section>

